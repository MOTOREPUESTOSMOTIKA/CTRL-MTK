<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Motika | Sistema Profesional</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4A90E2">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js');
      }
    </script>
</head>
<body>
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <nav class="sidebar" id="sidebar">
        <h2>MOTIKA</h2>
        <ul>
            <li><button onclick="showSection('dashboard'); toggleMenu()">üè† Panel Control</button></li>
            <li><button onclick="showSection('inventario'); toggleMenu()">üì¶ Inventario</button></li>
            <li><button onclick="showSection('finanzas'); toggleMenu()">üí∞ Ventas/Caja</button></li>
            <li><button onclick="showSection('gastos-operativos'); toggleMenu()">‚õΩ Gastos Diarios</button></li>
            <li><button onclick="showSection('pedidos'); toggleMenu()">üìù Pedidos</button></li>
            <li><button onclick="showSection('deudas'); toggleMenu()">üìâ Deudas</button></li>
            <li><button onclick="showSection('reporte-general'); toggleMenu()">üìä Reporte General</button></li>
        </ul>
    </nav>

    <main class="content">

        <!-- ================= PANEL CONTROL ================= -->
        <section id="dashboard" class="active">
            <h1>Panel de Control</h1>

            <div class="dashboard-columns">

                <!-- DESDE SIEMPRE -->
                <div class="dashboard-col">
                    <h2>üìä Totales Desde Siempre</h2>
                    <div class="cards-container">
                        <div class="card"><h3>Ingresos</h3><p id="total-ingresos-global">$0</p></div>
                        <div class="card"><h3>Gastos</h3><p id="total-gastos-global">$0</p></div>
                        <div class="card card-resaltada"><h3>Efectivo</h3><p id="balance-global">$0</p></div>
                        <div class="card"><h3>Ganancia Real</h3><p id="ganancia-global">$0</p></div>
                    </div>
                </div>

                <!-- DESDE √öLTIMO CIERRE -->
                <div class="dashboard-col">
                    <h2>üìÖ Desde √öltimo Cierre</h2>
                    <div class="cards-container">
                        <div class="card"><h3>Ingresos</h3><p id="total-ingresos-parcial">$0</p></div>
                        <div class="card"><h3>Gastos</h3><p id="total-gastos-parcial">$0</p></div>
                        <div class="card card-resaltada"><h3>Efectivo</h3><p id="balance-parcial">$0</p></div>
                        <div class="card"><h3>Ganancia Real</h3><p id="ganancia-parcial">$0</p></div>
                    </div>
                </div>

            </div>

            <div class="cards-container">
                <div class="card"><h3>Costo Inventario</h3><p id="dash-valor-inv">$0</p></div>
                <div class="card card-resaltada"><h3>Patrimonio Neto</h3><p id="dash-patrimonio">$0</p></div>
            </div>
        </section>

        <!-- ================= INVENTARIO ================= -->
        <section id="inventario">
            <h1>Inventario Stock</h1>
            <form id="form-producto">
                <input type="text" id="prod-nombre" placeholder="Producto" required>
                <input type="number" id="prod-cantidad" placeholder="Cant." required>
                <input type="number" id="prod-costo" placeholder="Costo Unit." step="0.01" required>
                <input type="number" id="prod-precio" placeholder="Precio Venta" step="0.01" required>
                <button type="submit" class="btn-main">Agregar al Stock</button>
            </form>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Stock</th>
                            <th>Costo</th>
                            <th>Venta</th>
                            <th>Editar</th>
                            <th>Eliminar</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-inventario"></tbody>
                </table>
            </div>

            <div class="floating-inventory">
                <p>Valor Costo: <span id="float-costo">$0</span> | Valor Venta: <span id="float-venta">$0</span></p>
            </div>
        </section>

        <!-- ================= RESTO SIN CAMBIOS ESTRUCTURALES ================= -->

        <section id="finanzas">
            <h1>Ventas y Caja</h1>
            <button onclick="cerrarCaja()" class="btn-main btn-danger">üîí Cerrar Caja y Guardar Reporte</button>
            
            <form id="form-transaccion">
                <select id="trans-tipo" onchange="toggleProductoSelector()">
                    <option value="venta">Venta de Stock</option>
                    <option value="ingreso">Otro Ingreso</option>
                    <option value="gasto">Gasto General</option>
                </select>

                <div id="contenedor-busqueda-prod">
                    <input type="text" id="input-buscar-prod" placeholder="Escribe nombre del producto..." autocomplete="off">
                    <div id="lista-sugerencias" class="sugerencias-dropdown"></div>
                    <input type="hidden" id="select-producto-id">
                </div>

                <input type="number" id="trans-cantidad" placeholder="Cant." value="1">
                <input type="text" id="trans-desc" placeholder="Descripci√≥n">
                <input type="number" id="trans-monto" placeholder="Monto $">
                <button type="submit" class="btn-main">Registrar Movimiento</button>
            </form>

            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Fecha</th><th>Descripci√≥n</th><th>Monto</th></tr></thead>
                    <tbody id="lista-transacciones"></tbody>
                </table>
            </div>
        </section>

        <section id="gastos-operativos">
            <h1>Gastos Diarios (Log√≠stica)</h1>
            <form id="form-gastos-diarios">
                <input type="date" id="gasto-fecha">
                <select id="gasto-categoria">
                    <option value="Surtido">Surtido</option>
                    <option value="Transporte">Transporte</option>
                    <option value="Otros">Otros</option>
                </select>
                <input type="text" id="gasto-desc-op" placeholder="Detalle" required>
                <input type="number" id="gasto-monto-op" placeholder="Monto $" required>
                <button type="submit" class="btn-main">Registrar Gasto</button>
            </form>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Fecha</th><th>Cat.</th><th>Detalle</th><th>Monto</th></tr></thead>
                    <tbody id="tabla-gastos-logistica"></tbody>
                </table>
            </div>
        </section>

        <section id="pedidos">
            <h1>Gesti√≥n de Pedidos</h1>
            <form id="form-encargo">
                <input type="text" id="enc-cliente" placeholder="Nombre Cliente" required>
                <div id="contenedor-filas-productos"></div>
                <button type="button" onclick="agregarFila()" class="btn-main">‚ûï A√±adir Fila</button>
                <input type="number" id="enc-total" placeholder="Total Pedido $" required>
                <input type="number" id="enc-abono" placeholder="Abono Inicial $" value="0">
                <button type="submit" class="btn-main">Guardar Pedido</button>
            </form>
            <div id="lista-pedidos-clientes" class="cards-container"></div>
        </section>

        <section id="deudas">
            <h1>Control de Deudores</h1>
            <form id="form-deuda-directa">
                <input type="text" id="deuda-cliente" placeholder="Nombre Cliente" required>
                <input type="number" id="deuda-monto" placeholder="Monto que debe $" required>
                <button type="submit" class="btn-main">Registrar Deuda</button>
            </form>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Cliente</th><th>Deuda Actual</th><th>Abonar</th><th>Acci√≥n</th></tr></thead>
                    <tbody id="tabla-deudores"></tbody>
                </table>
            </div>
        </section>

        <section id="reporte-general">
            <h1>Historial de Cierres de Caja</h1>
            <div id="historial-reportes"></div>
        </section>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSy...",
        authDomain: "sistema-motika.firebaseapp.com",
        databaseURL: "https://sistema-motika-default-rtdb.firebaseio.com",
        projectId: "sistema-motika",
        storageBucket: "sistema-motika.firebasestorage.app",
        messagingSenderId: "94857706277",
        appId: "1:94857706277:web:b16eddaf6b5b91606f38cc"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
    </script>

    <script src="script.js"></script>
</body>
</html>